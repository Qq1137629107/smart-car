C51 COMPILER V9.60.0.0   NRF24L01P                                                         11/22/2022 10:57:34 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE NRF24L01P
OBJECT MODULE PLACED IN .\Objects\nRF24L01P.obj
COMPILER INVOKED BY: D:\APP\Keil\C51\BIN\C51.EXE nRF24L01P.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listing
                    -s\nRF24L01P.lst) TABS(2) OBJECT(.\Objects\nRF24L01P.obj)

line level    source

   1          /*********************************************************************************************************
             -****
   2          Ԫܣ***STC15ϵnRF24L01P***
   3          ļƣNRF24L01P.c
   4          ƴ----2018325
   5          óѧϰ뽻ҵ;ʹñκκκ
   6          淶˵ΪĶȫֱʹôշ壬ֲʹСշ壬ʹȫд
   7          ÷ַΪȫֱSelfAddrƵʡͨRF24_RfSetup
   8                ֵӦ̨SI24R1оƬģ鼰nRF24L01P+PAڰشģ飬ʹģѡӦĹʲ
   9          **********************************************************************************************************
             -***/
  10          #include "nRF24L01P.h"
*** WARNING C318 IN LINE 4 OF nRF24L01P.h: can't open file 'STC15.H'
*** WARNING C318 IN LINE 5 OF nRF24L01P.h: can't open file 'Sys.h'
*** WARNING C318 IN LINE 7 OF nRF24L01P.h: can't open file 'Timer.h'
  11          
  12          
  13          U8 SelfAddr[TX_ADR_WIDTH] = {0x01, 0x01, 0x01, 0x01, 0x01};       //Ӳַ
  14          
  15          
  16          
  17          /*********************************************************************************************************
             -*****************/
  18          /*=========================================================˽к=======================================
             -================*/
  19          /*********************************************************************************************************
             -*****************/
  20          
  21          /*-----------------------------------------------------------------------------
  22          ƣSPI_RW
  23          byte͵һֽ
  24          ݣյһֽ
  25          ģSPIӿͨѶշһ廯
  26          ------------------------------------------------------------------------------*/
  27          U8 SPI_RW(U8 byte){
  28   1        U8 i;
  29   1        for(i=0; i<8; i++)
  30   1        {
  31   2          if(byte & 0x80)
  32   2            MOSI = 1;
*** ERROR C202 IN LINE 32 OF nRF24L01P.c: 'P13': undefined identifier
  33   2          else
  34   2            MOSI = 0;
*** ERROR C202 IN LINE 34 OF nRF24L01P.c: 'P13': undefined identifier
  35   2          byte = (byte << 1);
  36   2          SCK = 1;
*** ERROR C202 IN LINE 36 OF nRF24L01P.c: 'P15': undefined identifier
  37   2          byte |= MISO;
*** ERROR C202 IN LINE 37 OF nRF24L01P.c: 'P14': undefined identifier
  38   2          SCK = 0;
*** ERROR C202 IN LINE 38 OF nRF24L01P.c: 'P15': undefined identifier
  39   2        }
  40   1        return byte;
  41   1      }
C51 COMPILER V9.60.0.0   NRF24L01P                                                         11/22/2022 10:57:34 PAGE 2   

  42          
  43          /*-----------------------------------------------------------------------------
  44          ƣnRF24L01P_Write_Reg
  45          regĴӳַʽWRITE_REGregvalueдļĴֵ
  46          д״̬Ĵֵ
  47          ------------------------------------------------------------------------------*/
  48          void nRF24L01P_Write_Reg(U8 reg, U8 value){
  49   1        CSN = 0;
*** ERROR C202 IN LINE 49 OF nRF24L01P.c: 'P16': undefined identifier
  50   1        SPI_RW(reg);
  51   1        SPI_RW(value);
  52   1        CSN = 1;
*** ERROR C202 IN LINE 52 OF nRF24L01P.c: 'P16': undefined identifier
  53   1      }
  54          
  55          /*-----------------------------------------------------------------------------
  56          ƣnRF24L01P_Write_Buf
  57          regĴӳַʽWRITE_REGregpBufд׵ַbytesдֽ
  58          д״̬Ĵֵ
  59          ------------------------------------------------------------------------------*/
  60          void nRF24L01P_Write_Buf(U8 reg, const U8 *pBuf, U8 bytes){
  61   1        U8 i;
  62   1      
  63   1        CSN = 0;                                        
*** ERROR C202 IN LINE 63 OF nRF24L01P.c: 'P16': undefined identifier
  64   1        SPI_RW(reg);                          
  65   1        for(i=0; i<bytes; i++)     
  66   1          SPI_RW(*pBuf++);
  67   1        CSN = 1;     
*** ERROR C202 IN LINE 67 OF nRF24L01P.c: 'P16': undefined identifier
  68   1      }                            
  69          
  70          /*-----------------------------------------------------------------------------
  71          ƣnRF24L01P_Read_Reg
  72          regĴӳַʽREAD_REGreg
  73          ݣĴֵ
  74          ״̬Ĵֵֽڣ
  75          ------------------------------------------------------------------------------*/
  76          U8 nRF24L01P_Read_Reg(U8 reg){
  77   1        U8 value;
  78   1      
  79   1        CSN = 0;    
*** ERROR C202 IN LINE 79 OF nRF24L01P.c: 'P16': undefined identifier
  80   1        SPI_RW(reg);      
  81   1        value = SPI_RW(0);
  82   1        CSN = 1;              
*** ERROR C202 IN LINE 82 OF nRF24L01P.c: 'P16': undefined identifier
  83   1      
  84   1        return(value);
  85   1      }
  86          
  87          /*-----------------------------------------------------------------------------
  88          ƣnRF24L01P_Read_Reg
  89          regĴӳַʽREAD_REGregpBufջ׵ַbytesȡֽ
  90          ״̬Ĵֵֽڣ
  91          ------------------------------------------------------------------------------*/
  92          void nRF24L01P_Read_Buf(U8 reg, U8 *pBuf, U8 bytes){
  93   1        U8 i;
  94   1      
  95   1        CSN = 0;                                        
*** ERROR C202 IN LINE 95 OF nRF24L01P.c: 'P16': undefined identifier
  96   1        SPI_RW(reg);                           
C51 COMPILER V9.60.0.0   NRF24L01P                                                         11/22/2022 10:57:34 PAGE 3   

  97   1        for(i=0; i<bytes; i++)
  98   1          pBuf[i] = SPI_RW(0);                                    //ȡݣֽǰ
  99   1        CSN = 1;   
*** ERROR C202 IN LINE 99 OF nRF24L01P.c: 'P16': undefined identifier
 100   1      }
 101          
 102          
 103          /*********************************************************************************************************
             -*****************/
 104          /*=========================================================к=======================================
             -================*/
 105          /*********************************************************************************************************
             -*****************/
 106          
 107          /*-----------------------------------------------------------------------------
 108          ƣRF24_RfSetup
 109          chƵƵ
 110          nRF24L01P+Ƶ
 111          ------------------------------------------------------------------------------*/
 112          void RF24_SetRfCh(U8 ch){
 113   1        CE = 0;
*** ERROR C202 IN LINE 113 OF nRF24L01P.c: 'P17': undefined identifier
 114   1        nRF24L01P_Write_Reg(WR_RF_CH, ch);                          //ñƵͨ
 115   1        CE = 1;
*** ERROR C202 IN LINE 115 OF nRF24L01P.c: 'P17': undefined identifier
 116   1      }
 117          
 118          /*-----------------------------------------------------------------------------
 119          ƣRF24_Init
 120          nRF24L01P+ʼ
 121          ------------------------------------------------------------------------------*/
 122          void RF24_Init(){
 123   1        SCK = 0;                                  //SPIʱ
*** ERROR C202 IN LINE 123 OF nRF24L01P.c: 'P15': undefined identifier
 124   1        CSN = 1;                                  //Ƭѡߴδѡ״̬
*** ERROR C202 IN LINE 124 OF nRF24L01P.c: 'P16': undefined identifier
 125   1        CE  = 0;                                  //ʹãշʱҪ
*** ERROR C202 IN LINE 125 OF nRF24L01P.c: 'P17': undefined identifier
 126   1        IRQ = 1;                                  //ж̧ߴδж״̬
*** ERROR C202 IN LINE 126 OF nRF24L01P.c: 'P12': undefined identifier
 127   1      
 128   1        CE = 0;
*** ERROR C202 IN LINE 128 OF nRF24L01P.c: 'P17': undefined identifier
 129   1        nRF24L01P_Write_Reg(WR_SETUP_AW, 0x03);                           //õַΪ5ֽ
 130   1        nRF24L01P_Write_Reg(WR_RF_SETUP, RFSETUP);                    //ݴʡ书ΪRfSetupֵ
 131   1        nRF24L01P_Write_Reg(WR_EN_AA, 0x01);                            //ʹܽͨ0ԶӦ
 132   1        nRF24L01P_Write_Reg(WR_EN_RXADDR, 0x01);                    //ʹܽͨ0
 133   1        nRF24L01P_Write_Reg(WR_RX_PW_P0, TX_PLOAD_WIDTH);               //ͨ0ѡͷͨͬЧݿȣ
             -Ч
 134   1        nRF24L01P_Write_Reg(WR_SETUP_RETR, RETE_VAL);               //ԶطʱطЧ
 135   1        CE = 1;
*** ERROR C202 IN LINE 135 OF nRF24L01P.c: 'P17': undefined identifier
 136   1      }
 137          
 138          /*-----------------------------------------------------------------------------
 139          ƣRF24_RX_Mode
 140          nRF24L01P+Ϊģʽ
 141          ------------------------------------------------------------------------------*/
 142          void RF24_RX_Mode()
 143          {
 144   1        CE = 0;
*** ERROR C202 IN LINE 144 OF nRF24L01P.c: 'P17': undefined identifier
C51 COMPILER V9.60.0.0   NRF24L01P                                                         11/22/2022 10:57:34 PAGE 4   

 145   1        nRF24L01P_Write_Buf(WR_RX_ADDR_P0, SelfAddr, TX_ADR_WIDTH);         //豸ͨ0ʹúͷ豸ͬķ
             -͵ַ
 146   1        nRF24L01P_Write_Reg(WR_CONFIG, 0x0F);                           //CRCʹܣ16λCRCУ飬ģʽ
 147   1        nRF24L01P_Write_Reg(WR_STATUS, 0xFF);                     //ежϱ־λ
 148   1        CE = 1;                                                         //CE豸
*** ERROR C202 IN LINE 148 OF nRF24L01P.c: 'P17': undefined identifier
 149   1      }           
 150          
 151          /*-----------------------------------------------------------------------------
 152          ƣRF24_TX_Mode
 153          *toAddrĿַָ
 154          nRF24L01P+Ϊģʽ
 155          ------------------------------------------------------------------------------*/
 156          void RF24_TX_Mode(U8 *toAddr)
 157          {
 158   1        CE = 0;
*** ERROR C202 IN LINE 158 OF nRF24L01P.c: 'P17': undefined identifier
 159   1        nRF24L01P_Write_Buf(WR_TX_ADDR, toAddr, TX_ADR_WIDTH);            //д뷢͵ַ
 160   1        nRF24L01P_Write_Reg(WR_CONFIG, 0x0E);                       //CRCʹܣ16λCRCУ飬ģʽԶط
             -ж
 161   1        nRF24L01P_Write_Buf(WR_RX_ADDR_P0, toAddr, TX_ADR_WIDTH);         //ΪӦ豸ͨ0ַͷ͵ַ
             -ͬ
 162   1        nRF24L01P_Write_Reg(WR_STATUS, 0xFF);                     //ежϱ־λ
 163   1        //CE = 1;
 164   1      }
 165          
 166          /*-----------------------------------------------------------------------------
 167          ƣRF24_RxData
 168          *rxbufݵĻָ
 169          ݣǷյݣ1յ0δյ
 170          nRF24L01P+жǷյݣյֱȡӦѭе
 171          ------------------------------------------------------------------------------*/
 172          bit RF24_RxData(U8 *rxbuf)
 173          {
 174   1        U8 state;
 175   1      
 176   1        if(IRQ == 0)                                //жϴжжϿCPUЧʣSPIͨѶ
*** ERROR C202 IN LINE 176 OF nRF24L01P.c: 'P12': undefined identifier
 177   1        {
 178   2          state = nRF24L01P_Read_Reg(STATUS);                   //ȡ״̬Ĵֵ        
 179   2          nRF24L01P_Write_Reg(WR_STATUS, state);                  //RX_DSжϱ־
 180   2          if(state & RX_DR)                           //յ
 181   2          {
 182   3            nRF24L01P_Read_Buf(RD_RX_PLOAD,rxbuf,TX_PLOAD_WIDTH);       //ȡ
 183   3            nRF24L01P_Write_Reg(FLUSH_RX,0xFF);                 //RX FIFOĴ
 184   3            return ON; 
*** ERROR C202 IN LINE 184 OF nRF24L01P.c: 'ON': undefined identifier
 185   3          }
 186   2        }    
 187   1        return OFF;                                 //ûյκ
*** ERROR C202 IN LINE 187 OF nRF24L01P.c: 'OFF': undefined identifier
 188   1      }
 189          
 190          /*-----------------------------------------------------------------------------
 191          ƣRF24_TxData
 192          *txbufݵĻָ
 193          ݣǷͳɹ1ͳɹ0ʧ
 194          nRF24L01P+
 195          ------------------------------------------------------------------------------*/
 196          bit RF24_TxData(U8 *txbuf)
 197          {
 198   1        U8 state;
C51 COMPILER V9.60.0.0   NRF24L01P                                                         11/22/2022 10:57:34 PAGE 5   

 199   1        
 200   1        while(RPD == 1);
 201   1        CE=0;                                   //CEͣʹ24L01
*** ERROR C202 IN LINE 201 OF nRF24L01P.c: 'P17': undefined identifier
 202   1        nRF24L01P_Write_Buf(WR_TX_PLOAD,txbuf,TX_PLOAD_WIDTH);            //дݵTX FIFO,32ֽ
 203   1        CE=1;                                   //CEøߣʹܷ     
*** ERROR C202 IN LINE 203 OF nRF24L01P.c: 'P17': undefined identifier
 204   1      
 205   1        while(IRQ == 1);                              //ȴ
*** ERROR C202 IN LINE 205 OF nRF24L01P.c: 'P12': undefined identifier
 206   1        state=nRF24L01P_Read_Reg(STATUS);                       //ȡ״̬Ĵֵ     
 207   1        nRF24L01P_Write_Reg(WR_STATUS, state);                    //TX_DSMAX_RTжϱ־
 208   1        if(state&TX_DS)                               //
 209   1          return ON;
*** ERROR C202 IN LINE 209 OF nRF24L01P.c: 'ON': undefined identifier
 210   1        nRF24L01P_Write_Reg(FLUSH_TX,0xff);                     //TX FIFOĴ 
 211   1        return OFF;                                 //ʧ
*** ERROR C202 IN LINE 211 OF nRF24L01P.c: 'OFF': undefined identifier
 212   1      }
 213          
 214          
 215          
 216          
 217          
 218          /*********************************************************************************************************
             -****
 219          Ԫܣ***STC15ϵnRF24L01P***
 220          ļƣNRF24L01P.h
 221          ƴ----2018325
 222          óѧϰ뽻ҵ;ʹñκκκ
 223          淶˵ΪƫĶȫֱʹôշ壬ֲʹСշ壬ʹȫд
 224          ÷ַΪȫֱSelfAddrƵʡͨRF24_RfSetup
 225                ֵӦ̨SI24R1оƬģ鼰nRF24L01P+PAڰشģ飬ʹģѡӦĹʲ
 226          *******************************************
*** ERROR C300 IN LINE 226 OF nRF24L01P.c: unterminated comment

C51 COMPILATION COMPLETE.  3 WARNING(S),  33 ERROR(S)
